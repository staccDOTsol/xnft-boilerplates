{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import{nanoid}from'nanoid/non-secure';import*as React from'react';import useLatestCallback from'use-latest-callback';import NavigationHelpersContext from\"./NavigationHelpersContext\";import NavigationRouteContext from\"./NavigationRouteContext\";import PreventRemoveContext from\"./PreventRemoveContext\";var transformPreventedRoutes=function transformPreventedRoutes(preventedRoutesMap){var preventedRoutesToTransform=_toConsumableArray(preventedRoutesMap.values());var preventedRoutes=preventedRoutesToTransform.reduce(function(acc,_ref){var _acc$routeKey;var routeKey=_ref.routeKey,preventRemove=_ref.preventRemove;acc[routeKey]={preventRemove:((_acc$routeKey=acc[routeKey])===null||_acc$routeKey===void 0?void 0:_acc$routeKey.preventRemove)||preventRemove};return acc;},{});return preventedRoutes;};export default function PreventRemoveProvider(_ref2){var children=_ref2.children;var _React$useState=React.useState(function(){return nanoid();}),_React$useState2=_slicedToArray(_React$useState,1),parentId=_React$useState2[0];var _React$useState3=React.useState(new Map()),_React$useState4=_slicedToArray(_React$useState3,2),preventedRoutesMap=_React$useState4[0],setPreventedRoutesMap=_React$useState4[1];var navigation=React.useContext(NavigationHelpersContext);var route=React.useContext(NavigationRouteContext);var preventRemoveContextValue=React.useContext(PreventRemoveContext);var setParentPrevented=preventRemoveContextValue===null||preventRemoveContextValue===void 0?void 0:preventRemoveContextValue.setPreventRemove;var setPreventRemove=useLatestCallback(function(id,routeKey,preventRemove){if(preventRemove&&(navigation==null||navigation!==null&&navigation!==void 0&&navigation.getState().routes.every(function(route){return route.key!==routeKey;}))){throw new Error(\"Couldn't find a route with the key \"+routeKey+\". Is your component inside NavigationContent?\");}setPreventedRoutesMap(function(prevPrevented){var _prevPrevented$get,_prevPrevented$get2;if(routeKey===((_prevPrevented$get=prevPrevented.get(id))===null||_prevPrevented$get===void 0?void 0:_prevPrevented$get.routeKey)&&preventRemove===((_prevPrevented$get2=prevPrevented.get(id))===null||_prevPrevented$get2===void 0?void 0:_prevPrevented$get2.preventRemove)){return prevPrevented;}var nextPrevented=new Map(prevPrevented);if(preventRemove){nextPrevented.set(id,{routeKey:routeKey,preventRemove:preventRemove});}else{nextPrevented.delete(id);}return nextPrevented;});});var isPrevented=_toConsumableArray(preventedRoutesMap.values()).some(function(_ref3){var preventRemove=_ref3.preventRemove;return preventRemove;});React.useEffect(function(){if((route===null||route===void 0?void 0:route.key)!==undefined&&setParentPrevented!==undefined){setParentPrevented(parentId,route.key,isPrevented);return function(){setParentPrevented(parentId,route.key,false);};}return;},[parentId,isPrevented,route===null||route===void 0?void 0:route.key,setParentPrevented]);var value=React.useMemo(function(){return{setPreventRemove:setPreventRemove,preventedRoutes:transformPreventedRoutes(preventedRoutesMap)};},[setPreventRemove,preventedRoutesMap]);return React.createElement(PreventRemoveContext.Provider,{value:value},children);}","map":{"version":3,"sources":["PreventRemoveProvider.tsx"],"names":["nanoid","React","useLatestCallback","NavigationHelpersContext","NavigationRouteContext","PreventRemoveContext","transformPreventedRoutes","preventedRoutesMap","preventedRoutesToTransform","values","preventedRoutes","reduce","acc","routeKey","preventRemove","PreventRemoveProvider","children","parentId","useState","setPreventedRoutesMap","Map","navigation","useContext","route","preventRemoveContextValue","setParentPrevented","setPreventRemove","id","getState","routes","every","key","Error","prevPrevented","get","nextPrevented","set","delete","isPrevented","some","useEffect","undefined","value","useMemo"],"mappings":"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","sourceRoot":"../../src","sourcesContent":["import { nanoid } from 'nanoid/non-secure';\nimport * as React from 'react';\nimport useLatestCallback from 'use-latest-callback';\nimport NavigationHelpersContext from './NavigationHelpersContext';\nimport NavigationRouteContext from './NavigationRouteContext';\nimport PreventRemoveContext from './PreventRemoveContext';\n/**\n * Util function to transform map of prevented routes to a simpler object.\n */\nconst transformPreventedRoutes = preventedRoutesMap => {\n  const preventedRoutesToTransform = [...preventedRoutesMap.values()];\n  const preventedRoutes = preventedRoutesToTransform.reduce((acc, _ref) => {\n    var _acc$routeKey;\n    let {\n      routeKey,\n      preventRemove\n    } = _ref;\n    acc[routeKey] = {\n      preventRemove: ((_acc$routeKey = acc[routeKey]) === null || _acc$routeKey === void 0 ? void 0 : _acc$routeKey.preventRemove) || preventRemove\n    };\n    return acc;\n  }, {});\n  return preventedRoutes;\n};\n\n/**\n * Component used for managing which routes have to be prevented from removal in native-stack.\n */\nexport default function PreventRemoveProvider(_ref2) {\n  let {\n    children\n  } = _ref2;\n  const [parentId] = React.useState(() => nanoid());\n  const [preventedRoutesMap, setPreventedRoutesMap] = React.useState(new Map());\n  const navigation = React.useContext(NavigationHelpersContext);\n  const route = React.useContext(NavigationRouteContext);\n  const preventRemoveContextValue = React.useContext(PreventRemoveContext);\n  // take `setPreventRemove` from parent context - if exist it means we're in a nested context\n  const setParentPrevented = preventRemoveContextValue === null || preventRemoveContextValue === void 0 ? void 0 : preventRemoveContextValue.setPreventRemove;\n  const setPreventRemove = useLatestCallback((id, routeKey, preventRemove) => {\n    if (preventRemove && (navigation == null || navigation !== null && navigation !== void 0 && navigation.getState().routes.every(route => route.key !== routeKey))) {\n      throw new Error(`Couldn't find a route with the key ${routeKey}. Is your component inside NavigationContent?`);\n    }\n    setPreventedRoutesMap(prevPrevented => {\n      var _prevPrevented$get, _prevPrevented$get2;\n      // values haven't changed - do nothing\n      if (routeKey === ((_prevPrevented$get = prevPrevented.get(id)) === null || _prevPrevented$get === void 0 ? void 0 : _prevPrevented$get.routeKey) && preventRemove === ((_prevPrevented$get2 = prevPrevented.get(id)) === null || _prevPrevented$get2 === void 0 ? void 0 : _prevPrevented$get2.preventRemove)) {\n        return prevPrevented;\n      }\n      const nextPrevented = new Map(prevPrevented);\n      if (preventRemove) {\n        nextPrevented.set(id, {\n          routeKey,\n          preventRemove\n        });\n      } else {\n        nextPrevented.delete(id);\n      }\n      return nextPrevented;\n    });\n  });\n  const isPrevented = [...preventedRoutesMap.values()].some(_ref3 => {\n    let {\n      preventRemove\n    } = _ref3;\n    return preventRemove;\n  });\n  React.useEffect(() => {\n    if ((route === null || route === void 0 ? void 0 : route.key) !== undefined && setParentPrevented !== undefined) {\n      // when route is defined (and setParentPrevented) it means we're in a nested stack\n      // route.key then will be the route key of parent\n      setParentPrevented(parentId, route.key, isPrevented);\n      return () => {\n        setParentPrevented(parentId, route.key, false);\n      };\n    }\n    return;\n  }, [parentId, isPrevented, route === null || route === void 0 ? void 0 : route.key, setParentPrevented]);\n  const value = React.useMemo(() => ({\n    setPreventRemove,\n    preventedRoutes: transformPreventedRoutes(preventedRoutesMap)\n  }), [setPreventRemove, preventedRoutesMap]);\n  return /*#__PURE__*/React.createElement(PreventRemoveContext.Provider, {\n    value: value\n  }, children);\n}\n//# sourceMappingURL=PreventRemoveProvider.js.map"]},"metadata":{},"sourceType":"module"}